rules:
  - id: public-randomness
    languages: [move_on_aptos]
    message: |
      Public functions should invoke randomness through other functions with stricter visibility control.
    severity: WARNING
    patterns:
      # Randomness macros
      - pattern-either:
        - pattern: |
            #[lint::allow_unsafe_randomness]
            fun $FUN (...) : ...
        - pattern: |
            #[randomness]
            fun $FUN (...) : ...
      # Visibility control
      - pattern-either:
        - pattern: |
            public fun $FUN (...) : ...
        - pattern: |
            public(friend) fun $FUN (...) : ...
      # Tests are exempted
      - pattern-not: |
          #[test]
          fun $FUN (...) : ...
      - pattern-not: |
          #[test(...)]
          fun $FUN (...) : ...
      - pattern-not: |
          #[test_only]
          fun $FUN (...) : ...