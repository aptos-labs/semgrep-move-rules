rules:
  - id: objects-stored-without-account
    languages:
      - move_on_aptos
    severity: ERROR
    confidence: MEDIUM
    message: >
      Storing different objects in the same account is not recommended. Objects
      should be stored at separate object accounts.
    patterns:
      - pattern-inside: |-
          #[resource_group_member(group = ...)]
          struct $STRUCT { ... }
          ...
      - pattern-inside: |-
          fun $FUN(...) : ... { ... }
      
      # We are looking for double (or more) move_to calls with object within the same
      # resource group.
      - pattern-inside: |-
          move_to($DEST, $VAR);
          ...
          move_to($DEST, ...);
          ...
      - metavariable-pattern:
          metavariable: $VAR
          patterns:
            - pattern-either:
              - pattern: $STRUCT { ... }
              - pattern: |
                  ($VAR : $STRUCT)

      # To minimize false positives, we require that there should be at least one
      # object operation on $STRUCT type.
      - pattern: object::$TRANSFER<$STRUCT>(...)
                
