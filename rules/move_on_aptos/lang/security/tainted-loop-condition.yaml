rules:
  - id: tainted-loop-condition
    languages: [move_on_aptos]
    mode: taint
    severity: INFO
    message: |
        Unchecked user input as loop conditions could lead to unbounded execution or slowing down the program.
    pattern-sources:
      - patterns:
          - pattern-inside: |
              public fun $FUN(..., $INPUT: $TYPE, ...) : ... { ... }
          - focus-metavariable: $INPUT
    pattern-sanitizers:
      - patterns:
          - pattern-not-inside: |
              for(...) { ... }
          - pattern-not-inside: |
              while(...) { ... }
          - pattern-inside: |
              if (<... $INPUT ...>) { ... };
              ...
          # - focus-metavariable: $INPUT
        # by-side-effect: true
    pattern-sinks:
      - patterns:
        - pattern-either:
          - pattern: |
              if (<... $INPUT ...>) {
                ...
                break;
              }
          - pattern: |
              if (<... $INPUT ...>) {
                ...
                continue;
              }
          - pattern: |
              if (<... $INPUT ...>) {
                ...
                return ...;
              }
          - pattern: |
              if (<... $INPUT ...>) {
                ...
                abort ...;
              }
        - pattern-either:
          - pattern-inside: |
              for (...) {
                ...
              }
          - pattern-inside: |
              while (...) {
                ...
              }